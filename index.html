<!doctype html>
<!-- The Time Machine GitHub pages theme was designed and developed by Jon Rohan, on Feb 7, 2012. -->
<!-- Follow him for fun. http://twitter.com/jonrohan. Tail his code on http://github.com/jonrohan -->
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <link rel="stylesheet" href="stylesheets/stylesheet.css" media="screen"/>
  <link rel="stylesheet" href="stylesheets/pygment_trac.css"/>
  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
  <script type="text/javascript" src="javascripts/script.js"></script>

  <title>Visor</title>
  <meta name="description" content="Simplistic ElasticSearch Bridge API for Groovy Projects">

  <meta name="viewport" content="width=device-width,initial-scale=1">

</head>

<body>

  <div class="wrapper">
    <header>
      <h1 class="title">Visor</h1>
    </header>
    <div id="container">
      <p class="tagline">Simplistic ElasticSearch Bridge API for Groovy Projects</p>
      <div id="main" role="main">
        <div class="download-bar">
        <div class="inner">
          <a href="https://github.com/morologous/visor/tarball/master" class="download-button tar"><span>Download</span></a>
          <a href="https://github.com/morologous/visor/zipball/master" class="download-button zip"><span>Download</span></a>
          <a href="https://github.com/morologous/visor" class="code">View Visor on GitHub</a>
        </div>
        <span class="blc"></span><span class="trc"></span>
        </div>
        <article class="markdown-body">
          <h3>What is Visor?</h3>

<p>Visor is a bridge API to help <a href="http://groovy.codehaus.org/">Groovy</a> applications store and search information in <a href="http://www.elasticsearch.org">ElasticSearch</a>.  The intent of this API is to be as low-impact as possible for the user while still providing a high level of available customization.</p>

<h3>Get Visor</h3>

<h4>Github</h4>

<p>Fork, clone or download this project at its <a href="http://github.com/morologous/visor">github page</a></p>

<h4>Maven</h4>

<p>Visor artifacts are available on the open source Sonatype repository at <a href="https://oss.sonatype.org">https://oss.sonatype.org</a></p>

<div class="highlight">
<pre><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>net.yankus<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>visor<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>0.1<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre>
</div>


<h3>How does Visor work?</h3>

<p>Visor interacts with the ElasticSearch server using the <a href="http://www.elasticsearch.org/guide/reference/groovy-api/">ElasticSearch Groovy API</a>.   Visor is configured using class- and property-level annotations.</p>

<p>Let's say you have a bean like this:</p>

<div class="highlight">
<pre><span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>
   <span class="kt">def</span> <span class="n">isbn</span>
   <span class="kt">def</span> <span class="n">title</span>
   <span class="kt">def</span> <span class="n">publishDate</span>
   <span class="kt">def</span> <span class="n">author</span>
   <span class="kt">def</span> <span class="n">pages</span>
   <span class="kt">def</span> <span class="n">categories</span>
<span class="o">}</span>                 
</pre>
</div>


<p>To make this bean searchable using Visor, judiciously add Visor, Id and Field annotations</p>

<div class="highlight">
<pre><span class="nd">@Visor</span><span class="o">(</span><span class="n">index</span><span class="o">=</span><span class="s1">'books'</span><span class="o">)</span>
<span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>
   <span class="nd">@Id</span>
   <span class="kt">def</span> <span class="n">isbn</span>
   <span class="nd">@Field</span>
   <span class="kt">def</span> <span class="n">title</span>
   <span class="nd">@Field</span><span class="o">(</span><span class="n">type</span><span class="o">=</span><span class="n">Date</span><span class="o">)</span>
   <span class="kt">def</span> <span class="n">publishDate</span>
   <span class="nd">@Field</span>
   <span class="kt">def</span> <span class="n">author</span>
   <span class="nd">@Field</span>
   <span class="kt">def</span> <span class="n">pages</span>
   <span class="nd">@Field</span>
   <span class="kt">def</span> <span class="n">categories</span>
<span class="o">}</span>
</pre>
</div>


<p>In this example, we've annotated the appropriate fields.  One important note is the publishDate field.  To unlock some additional functionality for date searching the type property has been set on the Field annotation.  This hints Visor to watch out for Date data or Date range type searches.  More on that later.</p>

<p>When the Visor annotation is added to the bean several instance methods are added.  These are:</p>

<ul>
<li>
<strong>book.index()</strong>   add this object to the index</li>
<li>
<strong>book.search()</strong>   search for objects like this one in the index</li>
<li>
<strong>book.update()</strong>   convenience method for reindexing data, semantically the same as .index()</li>
<li>
<strong>book.delete()</strong>   remove this object (by id) from the index</li>
</ul><h4>Putting it all together</h4>

<p>Now that we've configured Visor, we can start working with the index:</p>

<div class="highlight">
<pre><span class="c1">// create a representative book</span>
<span class="kt">def</span> <span class="n">book</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Book</span><span class="o">(</span><span class="nl">isbn:</span><span class="s1">'0-684-84328-5'</span><span class="o">,</span> 
                    <span class="nl">title:</span><span class="s1">'Visor Style Guide: Dangers and Pitfalls'</span><span class="o">,</span>
                    <span class="nl">publishDate:</span> <span class="n">parseDate</span><span class="o">(</span><span class="s1">'2010-01-31'</span><span class="o">),</span>
                    <span class="nl">author:</span> <span class="s1">'Cornelius D. Bagg'</span><span class="o">,</span>
                    <span class="nl">pages:</span> <span class="mi">235</span><span class="o">,</span>
                    <span class="nl">categories:</span> <span class="o">[</span><span class="s1">'self-help'</span><span class="o">,</span> <span class="s1">'fashion'</span><span class="o">])</span>

<span class="c1">// store the book                   </span>
<span class="n">book</span><span class="o">.</span><span class="na">index</span><span class="o">()</span>

<span class="c1">// search for other books by the same author</span>
<span class="kt">def</span> <span class="n">results</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Book</span><span class="o">(</span><span class="nl">author:</span><span class="s1">'*D. Bagg'</span><span class="o">).</span><span class="na">search</span><span class="o">()</span>

<span class="c1">// print the results</span>
<span class="n">println</span> <span class="s2">"$results.count books by Cornelius D. Bagg:"</span>
<span class="n">results</span><span class="o">.</span><span class="na">list</span><span class="o">.</span><span class="na">each</span> <span class="o">{</span>
    <span class="n">println</span> <span class="n">it</span>
<span class="o">}</span>
</pre>
</div>


<h4>Special Searches</h4>

<h5>Collections</h5>

<p>Visor can search for beans that match a parameter in a list (like a SQL IN clause).  To perform this kind of search, use the MultiSelect object.  Here is an example:</p>

<div class="highlight">
<pre><span class="c1">// search for books in the fashion or fitness category</span>
<span class="kt">def</span> <span class="n">results</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Book</span><span class="o">(</span>
    <span class="nl">categories:</span> <span class="k">new</span> <span class="n">MultiSelect</span><span class="o">(</span><span class="nl">values:</span><span class="o">[</span><span class="s1">'fashion'</span><span class="o">,</span> <span class="s1">'fitness'</span><span class="o">])</span>
<span class="o">).</span><span class="na">search</span><span class="o">()</span>

<span class="c1">// print the results</span>
<span class="n">println</span> <span class="s2">"$results.count books returned from search:"</span>
<span class="n">results</span><span class="o">.</span><span class="na">list</span><span class="o">.</span><span class="na">each</span> <span class="o">{</span>
    <span class="n">println</span> <span class="n">it</span>
<span class="o">}</span>
</pre>
</div>


<h5>Date Ranges</h5>

<p>Visor can perform Date Range searches as well.  When performing a date range search simply substitute the DateRange object for the Date in the bean.  Here is an example of a 'Between' range query:</p>

<div class="highlight">
<pre><span class="c1">// search for books published in 2010.</span>
<span class="kt">def</span> <span class="n">results</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Book</span><span class="o">(</span>
    <span class="nl">publishDate:</span> <span class="k">new</span> <span class="n">DateRange</span><span class="o">(</span><span class="nl">from:</span> <span class="n">parseDate</span><span class="o">(</span><span class="s1">'2010-01-01'</span><span class="o">),</span> 
                               <span class="nl">to:</span>   <span class="n">parseDate</span><span class="o">(</span><span class="s1">'2010-12-31'</span><span class="o">)</span>
<span class="o">).</span><span class="na">search</span><span class="o">()</span>

<span class="c1">// print the results</span>
<span class="n">println</span> <span class="s2">"$results.count books returned from search:"</span>
<span class="n">results</span><span class="o">.</span><span class="na">list</span><span class="o">.</span><span class="na">each</span> <span class="o">{</span>
    <span class="n">println</span> <span class="n">it</span>
<span class="o">}</span>
</pre>
</div>


<p>For 'Before' or 'After' simply omit the 'from' property (for 'Before' queries) or the 'to' property (for 'After' queries).  In all cases the search will be inclusive of the 'to' and 'from' dates, so consider the time values provided for the dates accordingly.</p>

<h5>Query String</h5>

<p>The Visor annotation also adds a 'queryString' property to the bean, for free form text searching of the documents in the index.</p>

<div class="highlight">
<pre><span class="c1">// search for books with titles</span>
<span class="kt">def</span> <span class="n">results</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Book</span><span class="o">(</span><span class="nl">queryString:</span><span class="s1">'Pitfalls OR Pratfalls'</span><span class="o">).</span><span class="na">search</span><span class="o">()</span>

<span class="n">println</span> <span class="s2">"$results.count books returned from search:"</span>
<span class="n">results</span><span class="o">.</span><span class="na">list</span><span class="o">.</span><span class="na">each</span> <span class="o">{</span>
    <span class="n">println</span> <span class="n">it</span>
<span class="o">}</span>
</pre>
</div>


<p>The query string syntax adheres to the <a href="http://lucene.apache.org/core/3_6_0/queryparsersyntax.html">Lucene Query Syntax</a> rules.  By default, the all fields in the document will be searched. </p>

<p><a href="http://morologous.github.com/visor"><img src="https://github.com/morologous/visor/raw/master/site/visor.png" alt="Visor"></a></p>

<p><a href="http://travis-ci.org/morologous/visor"><img src="https://secure.travis-ci.org/morologous/visor.png" alt="Build Status"></a></p>
        </article>
      </div>
    </div>
    <footer>
      <div class="owner">
      <p><a href="https://github.com/morologous" class="avatar"><img src="https://secure.gravatar.com/avatar/7d6f3c3a8e4f16e07ca8021e26568cac?s=30&amp;d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-140.png" width="48" height="48"/></a> <a href="https://github.com/morologous">morologous</a> maintains <a href="https://github.com/morologous/visor">Visor</a></p>
      </div>
      <div class="creds">
        <small>This page generated using <a href="https://pages.github.com/">GitHub Pages</a><br/>theme by <a href="http://twitter.com/jonrohan/">Jon Rohan</a></small>
      </div>
    </footer>
  </div>
  <div class="current-section">
    <a href="#top">Scroll to top</a>
    <a href="https://github.com/morologous/visor/tarball/master" class="tar">tar</a><a href="https://github.com/morologous/visor/zipball/master" class="zip">zip</a><a href="" class="code">source code</a>
    <p class="name"></p>
  </div>

  
</body>
</html>
